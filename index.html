<nav class="p-5 flex justify-between items-center bg-white border-b sticky top-0 z-50 shadow-sm">
    <h1 class="text-3xl font-black italic tracking-tighter cursor-pointer" onclick="location.reload()">OASIS</h1>
    
    <div class="relative hidden md:block">
        <input type="text" id="searchInput" oninput="searchProducts()" placeholder="Search luxury items..." class="bg-gray-100 px-6 py-2 rounded-full outline-none w-80 text-sm border focus:border-black transition-all">
        <i class="fa fa-search absolute right-4 top-3 text-gray-400"></i>
    </div>

    <div class="flex gap-6 items-center">
        <div class="relative cursor-pointer" onclick="toggleCart()">
            <i class="fa fa-shopping-bag text-xl"></i>
            <span id="cartCount" class="absolute -top-2 -right-2 bg-black text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">0</span>
        </div>
        <i class="fa fa-user-circle text-xl cursor-pointer" onclick="toggleProfile()"></i>
    </div>
</nav>

<div id="cartSidebar" class="fixed right-0 top-0 h-full w-80 bg-white shadow-2xl z-[100] transform translate-x-full transition-transform duration-300 p-6 overflow-y-auto">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold italic">YOUR BAG</h2>
        <i class="fa fa-times cursor-pointer text-xl" onclick="toggleCart()"></i>
    </div>
    <div id="cartItems" class="space-y-4">
        </div>
    <div class="border-t mt-10 pt-4">
        <div class="flex justify-between font-bold text-xl mb-4">
            <span>Total:</span>
            <span id="cartTotal">Rs. 0</span>
        </div>
        <button onclick="checkout()" class="w-full bg-black text-white py-4 rounded-2xl font-black hover:bg-gray-800 transition">CHECKOUT VIA WHATSAPP</button>
    </div>
</div>

<script>
    let allProducts = [];
    let cart = [];
    const REPO = "NeverPlayz7/oasis-store";

    // 1. SEARCH SYSTEM
    function searchProducts() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allProducts.filter(p => p.name.toLowerCase().includes(query));
        renderProducts(filtered);
    }

    // 2. FETCH & RENDER
    async function fetchProducts() {
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/data.json?t=${Date.now()}`);
            allProducts = await res.json();
            renderProducts(allProducts);
        } catch(e) { console.log("Error loading products"); }
    }

    function renderProducts(products) {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = products.map((p, index) => `
            <div class="product-card group relative animate-fadeIn">
                <i class="fa fa-heart absolute top-4 right-4 z-10 cursor-pointer text-gray-300 hover:text-red-500 transition-colors" 
                   onclick="toggleLike(this)"></i>
                
                <div class="overflow-hidden rounded-3xl bg-gray-100">
                    <img src="${p.image}" class="w-full h-80 object-cover group-hover:scale-110 transition-transform duration-500">
                </div>
                
                <div class="mt-4">
                    <h3 class="font-bold text-gray-800 truncate text-sm uppercase tracking-tight">${p.name}</h3>
                    <p class="text-black font-black text-lg">Rs. ${p.price}</p>
                    <button onclick="addToCart('${p.name}', ${p.price}, '${p.image}')" 
                            class="w-full mt-3 bg-white border-2 border-black text-black py-2 rounded-xl font-bold hover:bg-black hover:text-white transition-all active:scale-95">
                        Add to Cart
                    </button>
                </div>
            </div>
        `).join('');
    }

    // 3. CART SYSTEM
    function addToCart(name, price, img) {
        cart.push({ name, price, img });
        updateCartUI();
        // Simple notification
        const btn = event.target;
        btn.innerText = "âœ“ Added";
        setTimeout(() => btn.innerText = "Add to Cart", 1000);
    }

    function updateCartUI() {
        document.getElementById('cartCount').innerText = cart.length;
        const cartBox = document.getElementById('cartItems');
        let total = 0;

        cartBox.innerHTML = cart.map((item, index) => {
            total += parseInt(item.price);
            return `
                <div class="flex items-center gap-4 border-b pb-3">
                    <img src="${item.img}" class="w-12 h-12 rounded-lg object-cover">
                    <div class="flex-1">
                        <p class="text-xs font-bold truncate w-32">${item.name}</p>
                        <p class="text-sm font-black text-blue-600">Rs. ${item.price}</p>
                    </div>
                    <i class="fa fa-trash text-gray-300 hover:text-red-500 cursor-pointer" onclick="removeFromCart(${index})"></i>
                </div>
            `;
        }).join('');

        document.getElementById('cartTotal').innerText = `Rs. ${total}`;
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        updateCartUI();
    }

    function toggleCart() {
        const sidebar = document.getElementById('cartSidebar');
        sidebar.classList.toggle('translate-x-full');
    }

    // 4. LIKE & PROFILE
    function toggleLike(el) {
        el.classList.toggle('text-red-500');
        el.classList.toggle('text-gray-300');
    }

    function toggleProfile() {
        alert("Welcome, Ahmed! Dashboard is syncing...");
    }

    function checkout() {
        if(cart.length === 0) return alert("Your bag is empty!");
        let msg = "Assalam-o-Alaikum Oasis! I want to order:%0a";
        cart.forEach(item => msg += `- ${item.name} (Rs. ${item.price})%0a`);
        msg += `%0aTotal: ${document.getElementById('cartTotal').innerText}`;
        window.open(`https://wa.me/923138974516?text=${msg}`); // Apka number
    }

    fetchProducts();
</script>
