<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OASIS - Luxury Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; overflow-x: hidden; }
        .product-card:hover img { transform: scale(1.05); }
        .cart-sidebar { transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="bg-white">

<div id="loginModal" class="fixed inset-0 bg-black/70 backdrop-blur-md z-[200] flex items-center justify-center hidden p-4">
    <div class="bg-white w-full max-w-md rounded-[40px] p-10 shadow-2xl text-center">
        <h2 class="text-3xl font-black italic mb-2">OASIS</h2>
        <p class="text-gray-400 mb-8 font-bold text-xs uppercase tracking-widest">Join the Club</p>
        <div class="space-y-4">
            <button onclick="socialLogin('Google')" class="w-full flex items-center justify-center gap-4 border-2 py-4 rounded-2xl font-bold hover:bg-gray-50 transition"><img src="https://www.svgrepo.com/show/355037/google.svg" class="w-6"> Google</button>
            <button onclick="socialLogin('Facebook')" class="w-full bg-[#1877F2] text-white py-4 rounded-2xl font-bold transition"><i class="fab fa-facebook"></i> Facebook</button>
            <button onclick="socialLogin('Twitter')" class="w-full bg-black text-white py-4 rounded-2xl font-bold transition"><i class="fab fa-x-twitter"></i> Twitter</button>
        </div>
    </div>
</div>

<nav class="p-5 flex justify-between items-center bg-white border-b sticky top-0 z-50">
    <h1 class="text-3xl font-black italic tracking-tighter cursor-pointer">OASIS</h1>
    <div class="flex-1 max-w-md mx-10 hidden md:block">
        <input type="text" id="searchInput" oninput="searchItems()" placeholder="Search luxury..." class="w-full bg-gray-100 px-6 py-2 rounded-full outline-none text-sm border focus:border-black">
    </div>
    <div class="flex gap-6 items-center">
        <div class="relative cursor-pointer" onclick="toggleCart()"><i class="fa fa-shopping-bag text-xl"></i><span id="cartCount" class="absolute -top-2 -right-2 bg-black text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">0</span></div>
        <i class="fa fa-user-circle text-xl cursor-pointer" onclick="openLogin()"></i>
    </div>
</nav>

<main class="max-w-7xl mx-auto px-6 py-12">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-8" id="productGrid"></div>
</main>

<div id="cartSidebar" class="fixed right-0 top-0 h-full w-80 bg-white shadow-2xl z-[100] translate-x-full cart-sidebar p-6">
    <h2 class="text-2xl font-black mb-8">MY BAG</h2>
    <div id="cartItems" class="space-y-4 h-[60vh] overflow-y-auto"></div>
    <div class="border-t pt-4 mt-4">
        <div class="flex justify-between font-black text-xl mb-6"><span>Total:</span><span id="cartTotal">Rs. 0</span></div>
        <button onclick="placeOrder()" class="w-full bg-black text-white py-5 rounded-2xl font-black shadow-xl">ORDER VIA WHATSAPP</button>
    </div>
</div>

<script>
    const TOKEN = "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";
    const REPO = "NeverPlayz7/oasis-store";
    let allProducts = [];
    let cart = [];

    // --- ANALYTICS & STATS ---
    async function trackAction(pid, type) {
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, { headers: { "Authorization": `token ${TOKEN}` }});
            const file = await res.json();
            let products = JSON.parse(atob(file.content));
            const idx = products.findIndex(p => p.id == pid);
            if(idx !== -1) {
                if(!products[idx].stats) products[idx].stats = { views:0, likes:0, carts:0 };
                products[idx].stats[type]++;
                await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                    method: "PUT", headers: { "Authorization": `token ${TOKEN}` },
                    body: JSON.stringify({ message: `Track ${type}`, content: btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2)))), sha: file.sha })
                });
            }
        } catch(e) {}
    }

    // --- LOGIN SYSTEM ---
    async function socialLogin(platform) {
        const name = prompt("Enter Name:");
        const email = prompt("Enter Email:");
        if(!name || !email) return;

        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/users.json`, { headers: { "Authorization": `token ${TOKEN}` }});
            const file = await res.json();
            const users = JSON.parse(atob(file.content));
            users.push({ name, email, platform, date: new Date().toLocaleString() });

            await fetch(`https://api.github.com/repos/${REPO}/contents/users.json`, {
                method: "PUT", headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({ message: "New User", content: btoa(JSON.stringify(users, null, 2)), sha: file.sha })
            });
            localStorage.setItem('oasis_user', name);
            location.reload();
        } catch(e) { alert("Login Error"); }
    }

    // --- ORDER & CART ---
    function addToCart(pid, name, price, img) {
        cart.push({ name, price, img });
        trackAction(pid, 'carts');
        updateCartUI();
    }

    async function placeOrder() {
        if(cart.length === 0) return alert("Empty!");
        const name = localStorage.getItem('oasis_user') || "Guest";
        // Save Order to JSON
        const res = await fetch(`https://api.github.com/repos/${REPO}/contents/orders.json`, { headers: { "Authorization": `token ${TOKEN}` }});
        const file = await res.json();
        const orders = JSON.parse(atob(file.content));
        orders.push({ customerName: name, productName: cart[0].name, totalPrice: document.getElementById('cartTotal').innerText, date: new Date().toLocaleString() });
        
        await fetch(`https://api.github.com/repos/${REPO}/contents/orders.json`, {
            method: "PUT", headers: { "Authorization": `token ${TOKEN}` },
            body: JSON.stringify({ message: "New Order", content: btoa(JSON.stringify(orders, null, 2)), sha: file.sha })
        });
        window.open(`https://wa.me/923138974516?text=Order From ${name}`);
    }

    // Boilerplate functions (fetch, render, search, toggle) go here...
    async function fetchProducts() {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/data.json?t=${Date.now()}`);
        allProducts = await res.json();
        renderProducts(allProducts);
    }

    function renderProducts(data) {
        document.getElementById('productGrid').innerHTML = data.map(p => `
            <div class="product-card group" onclick="trackAction(${p.id}, 'views')">
                <div class="relative overflow-hidden rounded-3xl bg-gray-100">
                    <img src="${p.image}" class="w-full h-80 object-cover transition duration-500">
                    <i class="fa fa-heart absolute top-4 right-4 text-gray-300 hover:text-red-500 cursor-pointer" onclick="trackAction(${p.id}, 'likes'); this.style.color='red'"></i>
                </div>
                <div class="mt-4">
                    <h3 class="font-bold text-sm uppercase">${p.name}</h3>
                    <p class="font-black text-xl">Rs. ${p.price}</p>
                    <button onclick="addToCart(${p.id}, '${p.name}', ${p.price}, '${p.image}')" class="w-full mt-3 border-2 border-black py-2 rounded-xl font-bold hover:bg-black hover:text-white transition">Add to Cart</button>
                </div>
            </div>
        `).join('');
    }

    function toggleCart() { document.getElementById('cartSidebar').classList.toggle('translate-x-full'); }
    function openLogin() { if(!localStorage.getItem('oasis_user')) document.getElementById('loginModal').classList.remove('hidden'); else alert("Hi " + localStorage.getItem('oasis_user')); }
    fetchProducts();
</script>
</body>
</html>
