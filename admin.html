<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oasis Admin - Mobile Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body { font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* Mobile Bottom Nav Shadow */
        .mobile-nav { shadow: 0 -4px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-24 md:pb-0">

    <div id="loginGate" class="fixed inset-0 bg-slate-900 flex items-center justify-center z-[100] p-4">
        <div class="bg-white p-8 rounded-[30px] w-full max-w-sm text-center shadow-2xl">
            <h2 class="text-3xl font-black italic mb-6">OASIS</h2>
            <div class="space-y-4">
                <input type="email" id="admEmail" placeholder="Admin Email" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-black">
                <input type="password" id="admPass" placeholder="Password" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-black">
                <button onclick="checkLogin()" class="w-full bg-black text-white py-4 rounded-2xl font-bold active:scale-95 transition">Login</button>
            </div>
            <p id="loginErr" class="text-red-500 mt-4 text-sm font-bold hidden text-center">Invalid Credentials!</p>
        </div>
    </div>

    <aside class="hidden md:flex flex-col w-64 bg-slate-900 text-white p-6 h-screen sticky top-0">
        <h2 class="text-2xl font-black italic mb-10 text-center">OASIS</h2>
        <nav class="space-y-4">
            <button onclick="switchTab('add')" class="w-full text-left p-3 rounded-xl hover:bg-slate-800 flex items-center gap-3"><i class="fa fa-plus"></i> Add Product</button>
            <button onclick="switchTab('logs')" class="w-full text-left p-3 rounded-xl hover:bg-slate-800 flex items-center gap-3"><i class="fa fa-history"></i> Activities</button>
            <button onclick="switchTab('orders')" class="w-full text-left p-3 rounded-xl hover:bg-slate-800 flex items-center gap-3"><i class="fa fa-shopping-cart"></i> Orders</button>
        </nav>
    </aside>

    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-4 z-50 mobile-nav">
        <button onclick="switchTab('add')" class="flex flex-col items-center text-slate-400 focus:text-black">
            <i class="fa fa-plus-circle text-xl"></i><span class="text-[10px] font-bold">Add</span>
        </button>
        <button onclick="switchTab('logs')" class="flex flex-col items-center text-slate-400 focus:text-black">
            <i class="fa fa-history text-xl"></i><span class="text-[10px] font-bold">Logs</span>
        </button>
        <button onclick="switchTab('orders')" class="flex flex-col items-center text-slate-400 focus:text-black">
            <i class="fa fa-shopping-bag text-xl"></i><span class="text-[10px] font-bold">Orders</span>
        </button>
    </div>

    <main class="flex-1 p-4 md:p-12 max-w-4xl mx-auto">
        
        <div id="tab-add" class="tab-content active">
            <h3 class="text-2xl font-black mb-6">New Product</h3>
            <div class="bg-white p-6 rounded-[25px] shadow-sm space-y-4 border">
                <input type="text" id="p-name" placeholder="Item Name" class="w-full p-4 bg-gray-50 border rounded-xl outline-none">
                <input type="number" id="p-price" placeholder="Price (PKR)" class="w-full p-4 bg-gray-50 border rounded-xl outline-none">
                <input type="text" id="p-img" placeholder="Image URL (Clear link)" class="w-full p-4 bg-gray-50 border rounded-xl outline-none">
                <button id="pubBtn" onclick="handleUpload()" class="w-full bg-green-600 text-white py-4 rounded-xl font-black text-lg shadow-md active:bg-green-700">Update Store</button>
                <p id="status" class="text-center font-bold text-sm min-h-[20px]"></p>
            </div>
        </div>

        <div id="tab-logs" class="tab-content">
            <h3 class="text-2xl font-black mb-6">Activity Group</h3>
            <div id="logBox" class="space-y-3"></div>
        </div>

        <div id="tab-orders" class="tab-content">
            <h3 class="text-2xl font-black mb-6">Recent Orders</h3>
            <div id="orderBox" class="space-y-3"></div>
        </div>

    </main>

<script>
    const TOKEN = "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"; 
    const REPO = "NeverPlayz7/oasis-store";
    let activeAdmin = "";

    function checkLogin() {
        const email = document.getElementById('admEmail').value.toLowerCase();
        const pass = document.getElementById('admPass').value;
        // Direct matching as requested
        if(email === "ahmedboss8603@gmail.com" && pass === "ahmed123") {
            activeAdmin = email;
            document.getElementById('loginGate').style.display = 'none';
            saveLog("Logged in via Mobile");
        } else {
            document.getElementById('loginErr').classList.remove('hidden');
        }
    }

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById(`tab-${id}`).classList.add('active');
        if(id === 'logs') loadLogs();
        if(id === 'orders') loadOrders();
    }

    async function handleUpload() {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const img = document.getElementById('p-img').value;
        const status = document.getElementById('status');

        if(!name || !price || !img) return alert("Fill all fields!");

        status.innerText = "⏳ Syncing...";
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            const file = await res.json();
            // FIX: Mobile devices sometimes fail atob if content is empty or malformed
            let content = [];
            try { content = JSON.parse(atob(file.content)); } catch(e) { content = []; }

            content.push({ name, price, image: img, id: Date.now() });

            const push = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({
                    message: `Mobile Upload: ${name}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
                    sha: file.sha
                })
            });

            if(push.ok) {
                status.innerHTML = "<span class='text-green-600'>✅ Product Published!</span>";
                saveLog(`Added Product: ${name}`);
                document.getElementById('p-name').value = '';
                document.getElementById('p-price').value = '';
                document.getElementById('p-img').value = '';
            } else { throw new Error(); }
        } catch(e) { 
            status.innerHTML = "<span class='text-red-500'>❌ Mobile Sync Error! Check Token.</span>";
            console.error(e);
        }
    }

    async function saveLog(act) {
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/activities.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            const file = await res.json();
            const logs = JSON.parse(atob(file.content));
            logs.push({ admin: activeAdmin, task: act, time: new Date().toLocaleString() });
            await fetch(`https://api.github.com/repos/${REPO}/contents/activities.json`, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({ message: "Log update", content: btoa(JSON.stringify(logs, null, 2)), sha: file.sha })
            });
        } catch(e) {}
    }

    async function loadLogs() {
        const box = document.getElementById('logBox');
        box.innerHTML = "Loading...";
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/activities.json?t=${Date.now()}`);
            const data = await res.json();
            box.innerHTML = data.reverse().slice(0, 15).map(l => `
                <div class="bg-white p-4 rounded-2xl shadow-sm border-l-4 border-slate-800">
                    <p class="font-bold text-sm">${l.admin}</p>
                    <p class="text-xs text-blue-500">${l.task}</p>
                    <p class="text-[9px] text-gray-400 mt-1">${l.time}</p>
                </div>
            `).join('');
        } catch(e) { box.innerHTML = "No logs found."; }
    }

    async function loadOrders() {
        const box = document.getElementById('orderBox');
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/orders.json?t=${Date.now()}`);
            const data = await res.json();
            box.innerHTML = data.reverse().map(o => `
                <div class="bg-white p-4 rounded-2xl shadow-sm border">
                    <p class="font-bold">${o.customerName} ordered ${o.productName}</p>
                    <p class="text-green-600 font-bold">Rs. ${o.totalPrice}</p>
                </div>
            `).join('');
        } catch(e) { box.innerHTML = "No orders yet."; }
    }
</script>
</body>
</html>
