<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oasis Admin - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="bg-gray-50 flex flex-col md:flex-row min-h-screen">

    <div id="loginGate" class="fixed inset-0 bg-black flex items-center justify-center z-[9999]">
        <div class="bg-white p-8 rounded-[30px] w-full max-w-sm mx-4 text-center shadow-2xl">
            <h2 class="text-3xl font-black italic mb-6">OASIS ADMIN</h2>
            <input type="email" id="admEmail" placeholder="Email" class="w-full p-4 border rounded-2xl mb-4 outline-none">
            <input type="password" id="admPass" placeholder="Password" class="w-full p-4 border rounded-2xl mb-6 outline-none">
            <button onclick="login()" class="w-full bg-black text-white py-4 rounded-2xl font-bold">Unlock Dashboard</button>
        </div>
    </div>

    <nav class="bg-black text-white w-full md:w-64 p-6 flex md:flex-col justify-between items-center md:items-start shrink-0">
        <h2 class="text-2xl font-black italic md:mb-10">DASHBOARD</h2>
        <div class="flex md:flex-col gap-6 font-bold text-sm">
            <button onclick="showTab('add')" class="hover:text-green-400"><i class="fa fa-plus md:mr-2"></i><span class="hidden md:inline">Add Product</span></button>
            <button onclick="showTab('logs')" class="hover:text-blue-400"><i class="fa fa-history md:mr-2"></i><span class="hidden md:inline">Activity Log</span></button>
        </div>
    </nav>

    <main class="flex-1 p-6 md:p-12">
        <div id="addTab" class="max-w-xl mx-auto bg-white p-8 rounded-[35px] shadow-lg border border-gray-100">
            <h3 class="text-2xl font-black mb-8">Publish New Product</h3>
            <div class="space-y-4">
                <input type="text" id="p-name" placeholder="Item Name" class="w-full p-4 border-2 rounded-2xl outline-none">
                <input type="number" id="p-price" placeholder="Price" class="w-full p-4 border-2 rounded-2xl outline-none">
                <input type="text" id="p-img" placeholder="Image URL" class="w-full p-4 border-2 rounded-2xl outline-none">
                <button id="addBtn" onclick="action('add')" class="w-full bg-green-600 text-white py-5 rounded-2xl font-black text-xl shadow-lg">Push to Store</button>
            </div>
            <p id="msg" class="mt-4 text-center font-bold"></p>
        </div>

        <div id="logsTab" class="hidden max-w-2xl mx-auto">
            <h3 class="text-2xl font-black mb-8">System Activities</h3>
            <div id="logBox" class="space-y-3"></div>
        </div>
    </main>

<script>
    const TOKEN = "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";
    const REPO = "NeverPlayz7/oasis-store";
    let activeUser = "";

    async function login() {
        const email = document.getElementById('admEmail').value;
        const pass = document.getElementById('admPass').value;
        try {
            const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/passwords.json?t=${Date.now()}`);
            const db = await res.json();
            if(db[email] === pass) {
                activeUser = email;
                document.getElementById('loginGate').style.display = 'none';
                logActivity("Logged In");
            } else { alert("Wrong credentials!"); }
        } catch(e) { alert("passwords.json not found!"); }
    }

    function showTab(tab) {
        document.getElementById('addTab').classList.toggle('hidden', tab !== 'add');
        document.getElementById('logsTab').classList.toggle('hidden', tab !== 'logs');
        if(tab === 'logs') loadLogs();
    }

    async function action(type) {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const img = document.getElementById('p-img').value;
        const msg = document.getElementById('msg');

        if(!name || !price || !img) return alert("Empty fields!");

        msg.innerText = "Processing...";
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            const file = await res.json();
            const data = JSON.parse(atob(file.content));
            data.push({ name, price, image: img });

            await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({ message: "Update Store", content: btoa(JSON.stringify(data, null, 2)), sha: file.sha })
            });

            msg.innerHTML = "<span class='text-green-600'>Product Added!</span>";
            logActivity(`Added Product: ${name}`);
        } catch(e) { msg.innerText = "Error!"; }
    }

    async function logActivity(act) {
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/activities.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            const file = await res.json();
            const logs = JSON.parse(atob(file.content));
            logs.push({ user: activeUser, action: act, time: new Date().toLocaleString() });

            await fetch(`https://api.github.com/repos/${REPO}/contents/activities.json`, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({ message: "Log Entry", content: btoa(JSON.stringify(logs, null, 2)), sha: file.sha })
            });
        } catch(e) { console.log("Log error"); }
    }

    async function loadLogs() {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/activities.json?t=${Date.now()}`);
        const data = await res.json();
        document.getElementById('logBox').innerHTML = data.reverse().map(l => `
            <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-black">
                <p class="font-bold text-sm">${l.user} - <span class="text-blue-600">${l.action}</span></p>
                <p class="text-[10px] text-gray-400">${l.time}</p>
            </div>
        `).join('');
    }
</script>
</body>
</html>
