<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OASIS ADMIN PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .tab-content { display: none; }
        .active { display: block; }
        .sidebar-item.active { background: #1e293b; color: white; border-left: 4px solid #38bdf8; }
    </style>
</head>
<body class="bg-slate-50 flex flex-col md:flex-row min-h-screen">

    <div id="login" class="fixed inset-0 bg-slate-900 z-[200] flex items-center justify-center p-5">
        <div class="bg-white p-10 rounded-[40px] max-w-sm w-full text-center shadow-2xl">
            <h2 class="text-3xl font-black italic mb-8">ADMIN</h2>
            <input type="password" id="pw" placeholder="Pin Code" class="w-full p-4 border rounded-2xl mb-4 text-center">
            <button onclick="if(document.getElementById('pw').value==='ahmed123')document.getElementById('login').remove()" class="w-full bg-black text-white py-4 rounded-2xl font-bold">UNLOCK</button>
        </div>
    </div>

    <aside class="w-72 bg-[#0f172a] text-slate-400 p-6 h-screen sticky top-0 hidden md:flex flex-col">
        <h2 class="text-white text-2xl font-black italic mb-10">OASIS PRO</h2>
        <div class="space-y-2">
            <button onclick="switchTab('add')" id="t-add" class="sidebar-item active w-full text-left p-4 rounded-xl font-bold flex items-center gap-3"><i class="fa fa-plus-circle"></i> Add Product</button>
            <button onclick="switchTab('users')" id="t-users" class="sidebar-item w-full text-left p-4 rounded-xl font-bold flex items-center gap-3"><i class="fa fa-users"></i> User List</button>
            <button onclick="switchTab('activity')" id="t-activity" class="sidebar-item w-full text-left p-4 rounded-xl font-bold flex items-center gap-3"><i class="fa fa-history"></i> Activity Group</button>
            <button onclick="switchTab('analytics')" id="t-analytics" class="sidebar-item w-full text-left p-4 rounded-xl font-bold flex items-center gap-3"><i class="fa fa-chart-line"></i> Analytics</button>
        </div>
        <p class="mt-auto text-[10px] font-bold text-slate-600 uppercase tracking-widest">Admin: ahmedboss8603@gmail.com</p>
    </aside>

    <main class="flex-1 p-8">
        
        <div id="add" class="tab-content active">
            <h3 class="text-3xl font-black mb-8">Add New Product</h3>
            <div class="bg-white p-8 rounded-[40px] border shadow-sm grid gap-4 max-w-2xl">
                <input id="n" type="text" placeholder="Product Name" class="p-4 bg-slate-50 rounded-2xl outline-none">
                <input id="p" type="number" placeholder="Price" class="p-4 bg-slate-50 rounded-2xl outline-none">
                <input id="i" type="text" placeholder="Image URL Link" class="p-4 bg-slate-50 rounded-2xl outline-none">
                <button onclick="upload()" id="upBtn" class="bg-blue-600 text-white py-5 rounded-3xl font-black shadow-lg hover:bg-blue-700">UPLOAD TO STORE</button>
            </div>
            <div id="invList" class="mt-10 grid gap-3 max-w-2xl"></div>
        </div>

        <div id="users" class="tab-content">
            <h3 class="text-3xl font-black mb-8">Registered Members</h3>
            <div id="uList" class="grid gap-3"></div>
        </div>

        <div id="activity" class="tab-content">
            <h3 class="text-3xl font-black mb-8">Recent Actions</h3>
            <div id="actList" class="space-y-3"></div>
        </div>

        <div id="analytics" class="tab-content">
            <h3 class="text-3xl font-black mb-8">Store Insights</h3>
            <div id="stats" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </div>

    </main>

<script>
    const TOKEN = "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";
    const REPO = "NeverPlayz7/oasis-store";

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.sidebar-item').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('t-'+id).classList.add('active');
        if(id === 'add') loadInv();
        if(id === 'users') loadUsers();
        if(id === 'activity') loadActivity();
        if(id === 'analytics') loadStats();
    }

    async function upload() {
        const name = document.getElementById('n').value;
        const price = document.getElementById('p').value;
        const image = document.getElementById('i').value;
        if(!name || !price || !image) return alert("Please fill all fields!");

        document.getElementById('upBtn').innerText = "Uploading...";
        const res = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, { headers: { "Authorization": `token ${TOKEN}` }});
        const file = await res.json();
        const data = JSON.parse(atob(file.content));
        data.push({ name, price, image, id: Date.now() });

        await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
            method: "PUT", headers: { "Authorization": `token ${TOKEN}` },
            body: JSON.stringify({ message: "Add item", content: btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2)))), sha: file.sha })
        });
        
        // Log Activity
        logActivity(`Added product: ${name}`);
        location.reload();
    }

    async function loadInv() {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/data.json?t=${Date.now()}`);
        const data = await res.json();
        document.getElementById('invList').innerHTML = data.map((item, idx) => `
            <div class="bg-white p-4 rounded-2xl border flex items-center justify-between">
                <div class="flex items-center gap-3"><img src="${item.image}" class="w-10 h-10 rounded-lg object-cover"><p class="font-bold text-sm">${item.name}</p></div>
                <button onclick="delProduct(${idx})" class="text-red-400 p-2"><i class="fa fa-trash"></i></button>
            </div>
        `).join('') || "Inventory is empty.";
    }

    async function logActivity(msg) {
        const res = await fetch(`https://api.github.com/repos/${REPO}/contents/activities.json`, { headers: { "Authorization": `token ${TOKEN}` }});
        const file = await res.json();
        const logs = JSON.parse(atob(file.content));
        logs.unshift({ msg, date: new Date().toLocaleString() });
        await fetch(`https://api.github.com/repos/${REPO}/contents/activities.json`, {
            method: "PUT", headers: { "Authorization": `token ${TOKEN}` },
            body: JSON.stringify({ message: "Log", content: btoa(JSON.stringify(logs.slice(0,20))), sha: file.sha })
        });
    }

    async function loadUsers() {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/users.json?t=${Date.now()}`);
        const data = await res.json();
        document.getElementById('uList').innerHTML = data.map(u => `<div class="bg-white p-4 rounded-2xl border font-bold text-sm">${u.name} <span class="text-gray-400 font-normal">(${u.email})</span></div>`).join('');
    }

    async function loadStats() {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/data.json?t=${Date.now()}`);
        const data = await res.json();
        document.getElementById('stats').innerHTML = `<div class="bg-black text-white p-6 rounded-[30px]">Total Products<p class="text-4xl font-black">${data.length}</p></div>`;
    }

    switchTab('add');
</script>
</body>
</html>
