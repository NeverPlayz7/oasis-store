const TOKEN = "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"; 
    const REPO = "NeverPlayz7/oasis-store";
    let adminEmail = "";
    let localProducts = []; // Local cache for speed

    function checkLogin() {
        const email = document.getElementById('admEmail').value.toLowerCase();
        const pass = document.getElementById('admPass').value;
        if(email === "ahmedboss8603@gmail.com" && pass === "ahmed123") {
            adminEmail = email;
            document.getElementById('loginGate').classList.add('hidden');
            saveLog("Dashboard Accessed");
            initDashboard(); // Foran data load karega
        } else {
            document.getElementById('loginErr').classList.remove('hidden');
        }
    }

    // 1. DASHBOARD INITIALIZATION (Auto-refresh every 30 seconds)
    function initDashboard() {
        refreshStats();
        loadInventory();
        loadLogs();
        setInterval(refreshStats, 30000); 
    }

    // 2. QUICK ADD (Optimistic UI)
    async function handleUpload() {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const img = document.getElementById('p-img').value;
        if(!name || !price || !img) return alert("Fields empty!");

        const status = document.getElementById('status');
        status.innerHTML = "<span class='text-blue-500 font-bold italic anim-pulse'>üöÄ Fast Syncing...</span>";

        // Step A: Foran UI update (Bina wait kiye)
        const newItem = { name, price, image: img, id: Date.now() };
        renderSingleItem(newItem); // Screen par foran dikhayega
        
        // Step B: Background mein GitHub update
        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            const file = await res.json();
            const products = JSON.parse(atob(file.content));
            products.push(newItem);

            await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({ 
                    message: `Quick Add: ${name}`, 
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2)))), 
                    sha: file.sha 
                })
            });

            status.innerHTML = "<span class='text-green-600'>‚úÖ Done!</span>";
            saveLog(`Added: ${name}`);
        } catch(e) { 
            status.innerHTML = "<span class='text-red-500'>‚ùå Failed. Check Token.</span>";
        }
    }

    // 3. QUICK DELETE (Instant Removal)
    async function deleteProduct(index, btnElement) {
        if(!confirm("Remove this item?")) return;

        // Foran screen se hatao
        const card = btnElement.closest('.product-card-ui');
        card.style.opacity = '0.3';
        card.style.pointerEvents = 'none';

        try {
            const res = await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            const file = await res.json();
            let products = JSON.parse(atob(file.content));
            const deletedName = products[index].name;
            products.splice(index, 1);

            await fetch(`https://api.github.com/repos/${REPO}/contents/data.json`, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}` },
                body: JSON.stringify({ 
                    message: `Quick Delete: ${deletedName}`, 
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2)))), 
                    sha: file.sha 
                })
            });
            
            card.remove(); // Delete confirmed
            saveLog(`Deleted: ${deletedName}`);
            refreshStats();
        } catch(e) {
            card.style.opacity = '1';
            alert("Delete failed on server.");
        }
    }

    // UI Helper: Naya item screen par chipkane ke liye
    function renderSingleItem(p) {
        const box = document.getElementById('inventoryList');
        const html = `
            <div class="product-card-ui bg-white p-4 rounded-3xl border flex items-center justify-between shadow-sm animate-pulse">
                <div class="flex items-center gap-4">
                    <img src="${p.image}" class="w-16 h-16 rounded-xl object-cover bg-slate-100">
                    <div>
                        <p class="font-bold text-slate-800">${p.name}</p>
                        <p class="text-blue-600 font-black text-sm">Rs. ${p.price}</p>
                    </div>
                </div>
            </div>`;
        box.insertAdjacentHTML('afterbegin', html);
    }
